@model RegistrationPortal.ViewModels.EditUserViewModel
@{
    ViewData["Title"] = "Edit Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - Registration Portal</title>

    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">

    <!-- Local CSS -->
    <link rel="stylesheet" href="~/css/edit-profile.css">
</head>

<body>
    <div class="edit-profile-container">
        <div class="profile-card animate__animated animate__fadeInUp">
            <!-- Profile Header -->
            <div class="profile-header">
                <h2>
                    <i class="fas fa-user-edit me-2"></i>
                    Edit Profile
                </h2>
                <p class="subtitle">Update your personal information</p>
            </div>

            <!-- Profile Body -->
            <div class="profile-body">
                <!-- Success Message -->
                <div id="success-message" class="alert alert-success d-none">
                    <i class="fas fa-check-circle me-2"></i>
                    <span id="success-text">Profile updated successfully!</span>
                </div>

                <!-- Error Message -->
                <div id="error-message" class="alert alert-danger d-none">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span id="error-text">Please fix the errors below.</span>
                </div>

                <!-- Edit Profile Form -->
                <form id="editProfileForm" asp-action="EditProfile" method="post">
                    @Html.AntiForgeryToken()
                    <input asp-for="UserID" type="hidden" />

                    <!-- Personal Information Section -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-user"></i>
                            Personal Information
                        </h3>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="FirstName" class="form-label">
                                        First Name <span class="required">*</span>
                                    </label>
                                    <input asp-for="FirstName"
                                           class="form-control"
                                           required
                                           data-validation="alphabets"
                                           placeholder="Enter your first name"
                                           maxlength="50" />
                                    <i class="fas fa-user input-icon"></i>
                                    <div class="validation-message error-message"></div>
                                    <div class="validation-message success-message">
                                        <i class="fas fa-check"></i> Looks good!
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="LastName" class="form-label">
                                        Last Name <span class="required">*</span>
                                    </label>
                                    <input asp-for="LastName"
                                           class="form-control"
                                           required
                                           data-validation="alphabets"
                                           placeholder="Enter your last name"
                                           maxlength="50" />
                                    <i class="fas fa-user input-icon"></i>
                                    <div class="validation-message error-message"></div>
                                    <div class="validation-message success-message">
                                        <i class="fas fa-check"></i> Looks good!
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="Username" class="form-label">
                                        Username <span class="required">*</span>
                                    </label>
                                    <input asp-for="Username"
                                           class="form-control"
                                           required
                                           data-validation="username"
                                           placeholder="Enter your username"
                                           maxlength="30" />
                                    <i class="fas fa-at input-icon"></i>
                                    <div class="inline-validation">
                                        <span class="validation-spinner d-none"><i class="fas fa-spinner fa-spin"></i></span>
                                        <span class="validation-check d-none"><i class="fas fa-check text-success"></i></span>
                                        <span class="validation-cross d-none"><i class="fas fa-times text-danger"></i></span>
                                    </div>
                                    <div class="validation-message error-message"></div>
                                    <div class="validation-message success-message">
                                        <i class="fas fa-check"></i> Username is available!
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="DateOfBirth" class="form-label">
                                        Date of Birth <span class="required">*</span>
                                    </label>
                                    <input asp-for="DateOfBirth"
                                           type="date"
                                           class="form-control"
                                           required
                                           data-validation="age" />
                                    <i class="fas fa-calendar input-icon"></i>
                                    <div class="validation-message error-message"></div>
                                    <div class="validation-message success-message">
                                        <i class="fas fa-check"></i> Valid age!
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="Gender" class="form-label">Gender</label>
                                    <select asp-for="Gender" class="form-control">
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                        <option value="PreferNot">Prefer not to say</option>
                                    </select>
                                    <i class="fas fa-venus-mars input-icon"></i>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="Country" class="form-label">
                                        Country <span class="required">*</span>
                                    </label>
                                    <select asp-for="Country" class="form-control" required>
                                        <option value="">Select Country</option>
                                        <option value="US">United States</option>
                                        <option value="UK">United Kingdom</option>
                                        <option value="CA">Canada</option>
                                        <option value="AU">Australia</option>
                                        <option value="IN">India</option>
                                        <option value="DE">Germany</option>
                                        <option value="FR">France</option>
                                        <option value="JP">Japan</option>
                                        <option value="BR">Brazil</option>
                                        <option value="Other">Other</option>
                                    </select>
                                    <i class="fas fa-globe input-icon"></i>
                                    <div class="validation-message error-message"></div>
                                    <div class="validation-message success-message">
                                        <i class="fas fa-check"></i> Country selected!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information Section -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-address-card"></i>
                            Contact Information
                        </h3>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="Email" class="form-label">
                                        Email Address <span class="required">*</span>
                                    </label>
                                    <input asp-for="Email"
                                           type="email"
                                           class="form-control"
                                           required
                                           data-validation="email"
                                           placeholder="Enter your email address"
                                           maxlength="100" />
                                    <i class="fas fa-envelope input-icon"></i>
                                    <div class="inline-validation">
                                        <span class="validation-spinner d-none"><i class="fas fa-spinner fa-spin"></i></span>
                                        <span class="validation-check d-none"><i class="fas fa-check text-success"></i></span>
                                        <span class="validation-cross d-none"><i class="fas fa-times text-danger"></i></span>
                                    </div>
                                    <div class="validation-message error-message"></div>
                                    <div class="validation-message success-message">
                                        <i class="fas fa-check"></i> Email is available!
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="PhoneNumber" class="form-label">
                                        Phone Number <span class="required">*</span>
                                    </label>
                                    <input asp-for="PhoneNumber"
                                           type="tel"
                                           class="form-control"
                                           required
                                           data-validation="phone"
                                           placeholder="Enter 10-digit phone number"
                                           maxlength="10" />
                                    <i class="fas fa-phone input-icon"></i>
                                    <div class="inline-validation">
                                        <span class="validation-spinner d-none"><i class="fas fa-spinner fa-spin"></i></span>
                                        <span class="validation-check d-none"><i class="fas fa-check text-success"></i></span>
                                        <span class="validation-cross d-none"><i class="fas fa-times text-danger"></i></span>
                                    </div>
                                    <div class="validation-message error-message"></div>
                                    <div class="validation-message success-message">
                                        <i class="fas fa-check"></i> Phone number is available!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Address Information Section -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-map-marker-alt"></i>
                            Address Information
                        </h3>

                        <div class="input-group-custom">
                            <label asp-for="StreetAddress" class="form-label">Street Address</label>
                            <input asp-for="StreetAddress"
                                   class="form-control"
                                   placeholder="Enter your street address"
                                   maxlength="200" />
                            <i class="fas fa-home input-icon"></i>
                        </div>

                        <div class="row">
                            <div class="col-md-4">
                                <div class="input-group-custom">
                                    <label asp-for="City" class="form-label">City</label>
                                    <input asp-for="City"
                                           class="form-control"
                                           data-validation="alphabets-spaces"
                                           placeholder="Enter your city"
                                           maxlength="50" />
                                    <i class="fas fa-map-marker-alt input-icon"></i>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group-custom">
                                    <label asp-for="State" class="form-label">State/Province</label>
                                    <input asp-for="State"
                                           class="form-control"
                                           data-validation="alphabets-spaces"
                                           placeholder="Enter your state/province"
                                           maxlength="50" />
                                    <i class="fas fa-map input-icon"></i>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group-custom">
                                    <label asp-for="ZipCode" class="form-label">ZIP/Postal Code</label>
                                    <input asp-for="ZipCode"
                                           class="form-control"
                                           data-validation="zipcode"
                                           placeholder="Enter 6-digit ZIP code"
                                           maxlength="6" />
                                    <i class="fas fa-mail-bulk input-icon"></i>
                                    <div class="validation-message error-message"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information Section -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-info-circle"></i>
                            Additional Information
                        </h3>

                        <div class="input-group-custom">
                            <label asp-for="Bio" class="form-label">Bio</label>
                            <textarea asp-for="Bio"
                                      class="form-control"
                                      rows="6"
                                      maxlength="1000"
                                      placeholder="Tell us about yourself (optional)"
                                      style="min-height: 120px; resize: vertical;"></textarea>
                            <i class="fas fa-user-edit input-icon"></i>
                            <div class="bio-counter">0/1000 characters</div>
                        </div>
                    </div>

                    <!-- Communication Preferences Section -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-bell"></i>
                            Communication Preferences
                        </h3>

                        <div class="form-check">
                            <input asp-for="ReceiveNewsletter" type="checkbox" class="form-check-input" />
                            <label asp-for="ReceiveNewsletter" class="form-check-label">
                                <i class="fas fa-newspaper me-1"></i>
                                Subscribe to newsletter and updates
                            </label>
                        </div>

                        <div class="form-check">
                            <input asp-for="ReceiveSMS" type="checkbox" class="form-check-input" />
                            <label asp-for="ReceiveSMS" class="form-check-label">
                                <i class="fas fa-sms me-1"></i>
                                Receive SMS alerts and notifications
                            </label>
                        </div>
                    </div>

                    <!-- Security Section -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-shield-alt"></i>
                            Security Settings
                        </h3>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="NewPassword" class="form-label">New Password (Optional)</label>
                                    <div class="input-container">
                                        <input asp-for="NewPassword"
                                               type="password"
                                               class="form-control"
                                               placeholder="Enter new password to change it"
                                               autocomplete="new-password"
                                               data-validation="password" />
                                        <i class="fas fa-lock input-icon"></i>
                                        <button type="button" class="password-toggle" onclick="togglePassword('NewPassword')">
                                            <i class="fas fa-eye" id="toggleIcon_NewPassword"></i>
                                        </button>
                                    </div>
                                    <div class="password-requirements" id="password-requirements" style="display: none;">
                                        <div class="requirement" id="req-length">
                                            <i class="fas fa-times"></i>
                                            <span>At least 8 characters</span>
                                        </div>
                                        <div class="requirement" id="req-uppercase">
                                            <i class="fas fa-times"></i>
                                            <span>At least one uppercase letter</span>
                                        </div>
                                        <div class="requirement" id="req-lowercase">
                                            <i class="fas fa-times"></i>
                                            <span>At least one lowercase letter</span>
                                        </div>
                                        <div class="requirement" id="req-number">
                                            <i class="fas fa-times"></i>
                                            <span>At least one number</span>
                                        </div>
                                        <div class="requirement" id="req-special">
                                            <i class="fas fa-times"></i>
                                            <span>At least one special character</span>
                                        </div>
                                    </div>
                                    <div class="validation-message error-message"></div>
                                    <div class="validation-message success-message">
                                        <i class="fas fa-check"></i> Strong password!
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="ConfirmNewPassword" class="form-label">Confirm New Password</label>
                                    <div class="input-container">
                                        <input asp-for="ConfirmNewPassword"
                                               type="password"
                                               class="form-control"
                                               placeholder="Confirm new password"
                                               autocomplete="new-password"
                                               data-validation="confirm-password" />
                                        <i class="fas fa-lock input-icon"></i>
                                        <button type="button" class="password-toggle" onclick="togglePassword('ConfirmNewPassword')">
                                            <i class="fas fa-eye" id="toggleIcon_ConfirmNewPassword"></i>
                                        </button>
                                    </div>
                                    <div class="validation-message error-message"></div>
                                    <div class="validation-message success-message">
                                        <i class="fas fa-check"></i> Passwords match!
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="SecurityQuestion" class="form-label">Security Question</label>
                                    <input asp-for="SecurityQuestion"
                                           class="form-control"
                                           placeholder="Enter your security question"
                                           maxlength="200" />
                                    <i class="fas fa-question-circle input-icon"></i>
                                    <div class="validation-message">
                                        <span class="error-message"><i class="fas fa-exclamation-circle"></i></span>
                                        <span class="success-message"><i class="fas fa-check-circle"></i> Valid question</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group-custom">
                                    <label asp-for="SecurityAnswer" class="form-label">Security Answer</label>
                                    <input asp-for="SecurityAnswer"
                                           class="form-control"
                                           placeholder="Enter your security answer"
                                           maxlength="100" />
                                    <i class="fas fa-key input-icon"></i>
                                    <div class="validation-message">
                                        <span class="error-message"><i class="fas fa-exclamation-circle"></i></span>
                                        <span class="success-message"><i class="fas fa-check-circle"></i> Valid answer</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="btn-group-custom">
                        <button type="submit" id="submitBtn" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>
                            Update Profile
                        </button>
                        <a href="@Url.Action("Profile", "Account")" class="btn btn-secondary">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Local JavaScript -->
    <script src="~/js/edit-profile.js"></script>

    <style>
        .input-container {
            position: relative;
        }

        .input-container .form-control {
            padding-right: 5rem; /* More space for both icons */
        }

        .input-container .input-icon {
            position: absolute;
            right: 3.5rem; /* Position lock icon further left */
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1rem;
            z-index: 2;
            pointer-events: none;
        }

        .password-toggle {
            position: absolute;
            right: 0.5rem; /* Position eye icon at far right */
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
            z-index: 3;
            padding: 0.5rem;
            transition: color 0.3s ease;
        }

        .password-toggle:hover {
            color: var(--text-primary);
        }

        .password-requirements {
            margin-top: 0.5rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .requirement {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.25rem 0;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .requirement.met {
            color: #4facfe;
        }

        .requirement i {
            width: 12px;
            font-size: 0.75rem;
        }
    </style>

    <script>
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const toggleIcon = document.getElementById('toggleIcon_' + fieldId);

            if (field.type === 'password') {
                field.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }
    </script>

    @section Scripts {
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Show validation errors if any
                @if (!ViewData.ModelState.IsValid)
                {
                    <text>
                    const errorMessages = [];
                    @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                    {
                        <text>errorMessages.push('@Html.Raw(error.ErrorMessage.Replace("'", "\\'"))');</text>
                    }

                    if (errorMessages.length > 0) {
                        showModelErrors(errorMessages);
                    }
                    </text>
                }

                // Show success message if any
                @if (TempData["SuccessMessage"] != null)
                {
                    <text>
                    showSuccess('@Html.Raw(TempData["SuccessMessage"].ToString().Replace("'", "\\'"))');
                    </text>
                }
            });
        </script>
    }
</body>
</html>